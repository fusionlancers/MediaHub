<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
 <title>üóÇÔ∏è Media List</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

	<nav class="navbar top-navbar">
		<ul class="navbar-links">
			<li><a href="/home">Home</a></li>
			<li><a href="/media">Media</a></li>
			<li><a href="/upload">Upload</a></li>
			<li><form action="/logout" method="post" style="display:inline;"><button type="submit" class="logout-btn">Logout</button></form></li>
		</ul>
	</nav>

  <div class="media-card">
    <h2 style="text-align:center;">View Uploaded Media</h2>
    <p style="text-align:center;"><a href="/media/upload" class="upload-btn">Upload new media</a></p>

    <% if (!media || media.length === 0) { %>
      <p style="text-align:center;">No media uploaded yet.</p>
    <% } else { %>
      <div class="media-table-wrapper">
        <table class="media-table">
            <tr>
              <th>SL NO</th>
              <th>Title</th>
              <th>Description</th>
              <th>Preview</th>
              <th>Actions</th>
            </tr>
            <% media.forEach((item, idx) => { %>
              <tr>
                <td><%= idx + 1 %></td>
                <td><%= item.title %></td>
                <td><%= item.description %></td>
                <td>
                <% if (item.contentType && item.contentType.startsWith('image')) { %>
                    <img src="/media/file/<%= item.fileId %>" class="media-preview-img" style="cursor:pointer" onclick="openPreviewModal('<%= item.fileId %>', '<%= item.contentType %>')" />
                <% } else if (item.contentType && item.contentType.startsWith('video')) { %>
                    <video src="/media/file/<%= item.fileId %>" class="media-preview-video" controls style="cursor:pointer" onclick="openPreviewModal('<%= item.fileId %>', '<%= item.contentType %>')"></video>
                <% } else if (item.contentType && item.contentType.startsWith('audio')) { %>
                  <audio src="/media/file/<%= item.fileId %>" class="media-preview-audio" controls></audio>
                <% } else { %>
                    <a href="/media/file/<%= item.fileId %>?download=true" class="download-btn">Download</a>
                <% } %>
                  <a href="/media/file/<%= item.fileId %>?download=true" class="download-btn" style="margin-top:6px;display:block;">Download</a>
              </td>
              <td>
                <button type="button" class="submit-btn" data-id="<%= item._id %>" data-title="<%= item.title.replace(/"/g, '&quot;') %>" data-desc="<%= item.description.replace(/"/g, '&quot;') %>" onclick="openEditModalFromBtn(this)">Edit</button>
                <a href="/media/delete/<%= item.fileId %>" class="delete-icon-btn" onclick="return confirm('Delete this file?')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m5 0V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </a>
              </td>
            </tr>
          <% }) %>
        </table>
      </div>
  <!-- Edit Modal -->
  <div id="editModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center;">
    <span style="position:absolute;top:30px;right:40px;font-size:2.5rem;color:#fff;cursor:pointer;" onclick="closeEditModal()">&times;</span>
    <form id="editForm" method="POST" style="background:#fff;padding:2rem 2.5rem;border-radius:14px;box-shadow:0 2px 16px #0002;min-width:320px;max-width:90vw;display:flex;flex-direction:column;gap:1rem;align-items:center;">
      <h3>Edit Media</h3>
      <input type="hidden" name="_id" id="editId" />
      <div style="width:100%">
        <label for="editTitle">Title</label>
        <input type="text" name="title" id="editTitle" required style="width:100%;padding:0.5rem;margin-top:0.3rem;" />
      </div>
      <div style="width:100%">
        <label for="editDesc">Description</label>
        <input type="text" name="description" id="editDesc" style="width:100%;padding:0.5rem;margin-top:0.3rem;" />
      </div>
      <button type="submit" class="submit-btn">Update</button>
    </form>
  </div>
  <script>
    function openEditModalFromBtn(btn) {
      var id = btn.getAttribute('data-id');
      var title = btn.getAttribute('data-title');
      var desc = btn.getAttribute('data-desc');
      document.getElementById('editModal').style.display = 'flex';
      document.getElementById('editId').value = id;
      document.getElementById('editTitle').value = title;
      document.getElementById('editDesc').value = desc;
      document.getElementById('editForm').action = '/media/update/' + id;
    }
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }
    window.onclick = function(event) {
      var modal = document.getElementById('editModal');
      if(event.target == modal) closeEditModal();
    }
  </script>
  
  <div id="previewModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;">
    <span style="position:absolute;top:30px;right:40px;font-size:2.5rem;color:#fff;cursor:pointer;" onclick="closePreviewModal()">&times;</span>
    <div id="previewContent" style="max-width:80vw;max-height:80vh;display:flex;align-items:center;justify-content:center;"></div>
  </div>
  <script>
    function openPreviewModal(fileId, contentType) {
      var modal = document.getElementById('previewModal');
      var content = document.getElementById('previewContent');
      content.innerHTML = '';
      if(contentType.startsWith('image')) {
        content.innerHTML = '<img src="/media/file/' + fileId + '" style="max-width:100%;max-height:80vh;border-radius:12px;box-shadow:0 2px 16px #0003;" />';
      } else if(contentType.startsWith('video')) {
        content.innerHTML = '<video src="/media/file/' + fileId + '" controls autoplay style="max-width:100%;max-height:80vh;border-radius:12px;box-shadow:0 2px 16px #0003;"></video>';
      }
      modal.style.display = 'flex';
    }
    function closePreviewModal() {
      document.getElementById('previewModal').style.display = 'none';
      document.getElementById('previewContent').innerHTML = '';
    }
    window.onclick = function(event) {
      var modal = document.getElementById('previewModal');
      if(event.target == modal) closePreviewModal();
    }
  </script>
    <% } %>
  </div>
</body>
</html>
